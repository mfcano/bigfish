<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Big Fish - Guild Shenanigans</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 576 512'><path fill='%2338bdf8' d='M180.5 141.5C219.7 108.5 272.6 80 336 80s116.3 28.5 155.5 61.5c39.1 33 66.9 72.4 81 99.8c4.7 9.2 4.7 20.1 0 29.3c-14.1 27.4-41.9 66.8-81 99.8C452.3 403.5 399.4 432 336 432s-116.3-28.5-155.5-61.5c-16.2-13.7-30.5-28.5-42.7-43.5L48.1 379.5c-12.5 10.1-30.8 11-44.3 2.3s-21.8-25.8-21.8-45.8V176c0-20 8.3-37.5 21.8-45.8s31.8-7.8 44.3 2.3l89.7 72.5c12.2-15 26.5-29.8 42.7-43.5zM384 218c-25-10-59.9-26-112-26s-87 16-112 26c-12.6 5.3-21 17-21 30.5c0 13.5 8.4 25.2 21 30.5c25 10 59.9 26 112 26s87-16 112-26c12.6-5.3 21-17 21-30.5c0-13.5-8.4-25.2-21-30.5z'/></svg>">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        guild: {
                            900: '#0f172a', // Deep blue/slate
                            800: '#1e293b',
                            700: '#334155',
                            accent: '#38bdf8', // Light blue
                            secondary: '#818cf8', // Indigo
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        rms: ['Verdana', 'Arial', 'Helvetica', 'sans-serif'],
                    },
                    fontSize: {
                        'rms-xs': '9px',
                        'rms-sm': '10px',
                        'rms-base': '11px',
                        'rms-lg': '12px',
                        'rms-xl': '13px',
                    }
                }
            }
        }
    </script>
    
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { font-family: 'Inter', sans-serif; }
        
        /* Theme: Ragnarok 2005 (RMS) - Forum Style */
        body.theme-rms {
            font-family: 'Verdana', Arial, Helvetica, sans-serif;
            font-size: 11px;
            background-color: #006699;
            color: #000000;
            background-image: none;
        }
        .theme-rms .container {
            max-width: 75%;
        }
        /* Centered content wrapper with background */
        .theme-rms main {
            background-color: #FFFFFF;
            max-width: 800px;
            margin: 0 auto;
            padding: 15px;
            border-left: 1px solid #000000;
            border-right: 1px solid #000000;
        }
        /* Special override for the banner text container in RMS theme */
        .theme-rms .banner-text-container h1 {
             color: #FFFFFF !important;
             font-size: 3rem !important;
             margin-bottom: 1rem;
             text-shadow: 2px 2px 4px #000000;
        }
        .theme-rms .banner-text-container p {
             color: #FFFFFF !important;
             font-size: 1.3rem !important;
             text-shadow: 1px 1px 2px #000000;
        }
        /* Header */
        .theme-rms nav {
            background: #006699;
            background: linear-gradient(to bottom, #006699 0%, #003366 100%);
            border-bottom: 0;
            height: auto;
            min-height: 40px;
        }
        .theme-rms .nav-link {
            color: #FFFFFF;
            text-decoration: none;
            font-weight: bold;
            font-size: 11px;
            padding: 0 10px;
        }
        .theme-rms .nav-link:hover {
            text-decoration: underline;
            background: transparent;
        }
        .theme-rms .nav-link.active {
            text-decoration: underline;
            background: transparent;
        }
        
        /* Forum Categories (Cards) */
        .theme-rms .card {
            background: #FFFFFF;
            border: 1px solid #000000;
            border-radius: 0;
            box-shadow: none;
            margin-bottom: 10px;
        }
        .theme-rms .card-header {
            background: #006699;
            background: linear-gradient(to bottom, #006699 0%, #003366 100%);
            color: #FFFFFF;
            font-weight: bold;
            font-size: 11px;
            padding: 5px 10px;
            border-bottom: 1px solid #000000;
        }
        
        /* Content Areas */
        .theme-rms .content-row {
            background-color: #DEE3E7;
            border-top: 1px solid #FFFFFF;
            border-bottom: 1px solid #D1D7DC;
            padding: 5px;
        }
        .theme-rms .content-row:nth-child(even) {
            background-color: #EFEFEF;
        }
        
        /* Typography */
        .theme-rms h1 { font-size: 16px; color: #000000; font-weight: bold; margin-bottom: 10px; }
        .theme-rms h2 { font-size: 14px; color: #006699; font-weight: bold; border: none; padding: 0; margin-bottom: 10px; }
        .theme-rms h3 { font-size: 12px; color: #000000; font-weight: bold; }
        .theme-rms p, .theme-rms span, .theme-rms div { font-size: 11px; }
        
        /* Buttons */
        .theme-rms button {
            font-family: 'Verdana', sans-serif;
            font-size: 10px;
            border-radius: 0 !important;
        }
        .theme-rms .btn-primary {
            background: #EFEFEF;
            border: 1px outset #FFFFFF;
            color: #000000;
            font-weight: bold;
        }
        .theme-rms .btn-primary:active {
            border: 1px inset #FFFFFF;
        }

        /* Tables */
        .theme-rms table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #000000;
        }
        .theme-rms th {
            background-color: #006699;
            color: #FFFFFF;
            font-weight: bold;
            font-size: 10px;
            text-align: center;
            border: 1px solid #000000;
            padding: 4px;
        }
        .theme-rms td {
            background-color: #DEE3E7;
            border: 1px solid #000000;
            padding: 4px;
            font-size: 11px;
            color: #000000;
        }
        .theme-rms tr:nth-child(even) td {
            background-color: #EFEFEF;
        }

        [x-cloak] { display: none !important; }
    </style>
</head>
<body 
    :class="{
        'bg-slate-50 text-slate-800': currentTheme === 'light',
        'bg-guild-900 text-slate-200': currentTheme === 'dark',
        'bg-[#1e1b2e] text-pink-50 selection:bg-pink-500 selection:text-white': currentTheme === 'cute',
        'bg-[#0000FF] text-white font-mono selection:bg-[#FFFF00] selection:text-[#0000FF]': currentTheme === 'mesi',
        'theme-rms': currentTheme === 'rms'
    }"
    class="min-h-screen flex flex-col transition-colors duration-300" 
    x-data="app()" 
    x-init="init()">

    <!-- Navigation -->
    <nav 
        :class="{
            'bg-white border-slate-200': currentTheme === 'light',
            'bg-guild-800 border-guild-700': currentTheme === 'dark',
            'bg-[#2a2438] border-pink-500/20 shadow-[0_4px_20px_-5px_rgba(236,72,153,0.1)]': currentTheme === 'cute',
            'bg-[#0000FF] border-b-4 border-[#FFFF00]': currentTheme === 'mesi',
            'border-b shadow-lg': currentTheme !== 'rms' && currentTheme !== 'cute' && currentTheme !== 'mesi',
            'border-b': currentTheme === 'cute'
        }"
        class="sticky top-0 z-50 transition-colors duration-300">
        
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between" :class="currentTheme === 'rms' ? 'h-10' : 'h-16'">
                <div class="flex items-center gap-4">
                    <div class="flex items-center cursor-pointer" @click="setTab('home')">
                        <div class="flex-shrink-0 mr-2" 
                             :class="{'text-guild-accent text-2xl': currentTheme === 'light' || currentTheme === 'dark', 'text-pink-400 text-2xl drop-shadow-[0_0_5px_rgba(236,72,153,0.5)]': currentTheme === 'cute', 'text-[#FFFF00] text-3xl animate-spin': currentTheme === 'mesi', 'text-white text-sm': currentTheme === 'rms'}">
                            <i class="fa-solid fa-fish"></i>
                        </div>
                        <div class="font-bold tracking-tight" 
                             :class="{'text-slate-900 text-xl': currentTheme === 'light', 'text-white text-xl': currentTheme === 'dark', 'text-transparent bg-clip-text bg-gradient-to-r from-pink-300 to-purple-300 text-xl font-extrabold': currentTheme === 'cute', 'text-[#FFFF00] text-2xl uppercase italic tracking-widest bg-[#FF00FF] px-2': currentTheme === 'mesi', 'text-white text-xs': currentTheme === 'rms'}">
                            BIG FISH
                        </div>
                    </div>
                    <!-- Server Time Display -->
                    <div class="font-mono text-xs hidden md:block" 
                         :class="{
                             'text-slate-600': currentTheme === 'light', 
                             'text-slate-400': currentTheme === 'dark', 
                             'text-pink-300/70': currentTheme === 'cute',
                             'text-[#00FF00] bg-black px-1': currentTheme === 'mesi',
                             'text-white text-[10px]': currentTheme === 'rms'
                         }">
                        <span x-text="`Server: ${serverTime} (GMT) | Local: ${localTime}`"></span>
                    </div>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-center space-x-4">
                        <template x-for="tab in tabs" :key="tab.id">
                            <button 
                                @click="setTab(tab.id)"
                                :class="getNavClass(tab.id)"
                                class="px-3 py-2 rounded-md transition-colors duration-200 nav-link"
                                x-text="currentTheme === 'rms' ? `[ ${tab.label} ]` : tab.label"
                            ></button>
                        </template>
                        
                        <!-- Theme Selector -->
                        <div class="relative ml-4" x-data="{ open: false }">
                            <button @click="open = !open" @click.away="open = false" 
                                :class="{'text-slate-500 hover:bg-slate-100': currentTheme === 'light', 'text-slate-400 hover:bg-guild-700': currentTheme === 'dark', 'text-pink-300 hover:bg-pink-500/20': currentTheme === 'cute', 'text-[#FFFF00] bg-[#FF00FF] border-2 border-white hover:bg-[#FFFF00] hover:text-[#0000FF]': currentTheme === 'mesi', 'text-white hover:bg-white/20 text-xs': currentTheme === 'rms'}"
                                class="p-2 rounded-md focus:outline-none flex items-center gap-2 transition-colors">
                                <i class="fa-solid fa-palette"></i>
                                <span class="font-bold uppercase" x-text="currentTheme"></span>
                            </button>
                            
                            <div x-show="open" 
                                 class="absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 z-50 ring-1 ring-black ring-opacity-5 focus:outline-none"
                                 :class="{'bg-white': currentTheme === 'light', 'bg-guild-800 border border-guild-700': currentTheme === 'dark', 'bg-[#2a2438] border border-pink-500/30 shadow-[0_0_15px_rgba(236,72,153,0.2)]': currentTheme === 'cute', 'bg-[#0000FF] border-4 border-[#FFFF00]': currentTheme === 'mesi'}"
                                 x-transition>
                                <button @click="setTheme('light'); open = false" class="block px-4 py-2 text-sm w-full text-left hover:bg-gray-100 dark:hover:bg-guild-700" :class="{'text-gray-900': currentTheme === 'light', 'text-white': currentTheme === 'dark' || currentTheme === 'cute' || currentTheme === 'mesi'}">
                                    <i class="fa-solid fa-sun w-6 text-center"></i> Light Mode
                                </button>
                                <button @click="setTheme('dark'); open = false" class="block px-4 py-2 text-sm w-full text-left hover:bg-gray-100 dark:hover:bg-guild-700" :class="{'text-gray-900': currentTheme === 'light', 'text-white': currentTheme === 'dark' || currentTheme === 'cute' || currentTheme === 'mesi'}">
                                    <i class="fa-solid fa-moon w-6 text-center"></i> Dark Mode
                                </button>
                                <button @click="setTheme('cute'); open = false" class="block px-4 py-2 text-sm w-full text-left hover:bg-gray-100 dark:hover:bg-guild-700 hover:text-pink-300" :class="{'text-gray-900': currentTheme === 'light', 'text-white': currentTheme === 'dark' || currentTheme === 'cute' || currentTheme === 'mesi'}">
                                    <i class="fa-solid fa-heart w-6 text-center text-pink-400"></i> Cute Mode
                                </button>
                                <button @click="setTheme('mesi'); open = false" class="block px-4 py-2 text-sm w-full text-left hover:bg-[#FFFF00] hover:text-[#0000FF] font-bold" :class="{'text-gray-900': currentTheme === 'light', 'text-white': currentTheme === 'dark' || currentTheme === 'cute' || currentTheme === 'mesi'}">
                                    <i class="fa-solid fa-eye w-6 text-center text-[#FFFF00]"></i> Mesi Mode
                                </button>
                                <button @click="setTheme('rms'); open = false" class="block px-4 py-2 text-sm w-full text-left hover:bg-gray-100 dark:hover:bg-guild-700" :class="{'text-gray-900': currentTheme === 'light', 'text-white': currentTheme === 'dark' || currentTheme === 'cute' || currentTheme === 'mesi'}">
                                    <i class="fa-solid fa-scroll w-6 text-center"></i> Ragnarok 2005
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Mobile menu button -->
                <div class="-mr-2 flex md:hidden">
                    <button @click="mobileMenuOpen = !mobileMenuOpen" type="button" 
                        class="inline-flex items-center justify-center p-2 rounded-md focus:outline-none"
                        :class="{'text-slate-400 hover:text-slate-900 hover:bg-slate-100': currentTheme === 'light', 'text-slate-400 hover:text-white hover:bg-guild-700': currentTheme === 'dark', 'text-pink-300 hover:text-pink-100 hover:bg-pink-500/20': currentTheme === 'cute', 'text-[#FFFF00] hover:bg-[#FFFF00] hover:text-[#0000FF]': currentTheme === 'mesi', 'text-white hover:bg-white/20': currentTheme === 'rms'}">
                        <i class="fa-solid" :class="mobileMenuOpen ? 'fa-times' : 'fa-bars'"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Mobile Menu -->
        <div class="md:hidden" x-show="mobileMenuOpen" x-cloak @click.away="mobileMenuOpen = false">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3 border-b"
                 :class="{'bg-white border-slate-200': currentTheme === 'light', 'bg-guild-800 border-guild-700': currentTheme === 'dark', 'bg-[#2a2438] border-pink-500/20': currentTheme === 'cute', 'bg-[#0000FF] border-[#FFFF00]': currentTheme === 'mesi', 'bg-[#006699] border-black': currentTheme === 'rms'}">
                <template x-for="tab in tabs" :key="tab.id">
                    <button 
                        @click="setTab(tab.id); mobileMenuOpen = false"
                        :class="getNavClass(tab.id)"
                        class="block w-full text-left px-3 py-2 rounded-md text-base font-medium nav-link"
                        x-text="currentTheme === 'rms' ? `[ ${tab.label} ]` : tab.label"
                    ></button>
                </template>
                <div class="border-t my-2" :class="{'border-slate-200': currentTheme === 'light', 'border-guild-700': currentTheme === 'dark', 'border-pink-500/20': currentTheme === 'cute', 'border-[#FFFF00]': currentTheme === 'mesi', 'border-white/20': currentTheme === 'rms'}"></div>
                <div class="px-3 py-2 text-xs font-bold uppercase opacity-50" :class="{'text-slate-900': currentTheme === 'light', 'text-white': currentTheme !== 'light'}">Theme</div>
                <button @click="setTheme('light'); mobileMenuOpen = false" class="block w-full text-left px-3 py-2 rounded-md text-base font-medium" :class="{'text-slate-900': currentTheme === 'light', 'text-white': currentTheme !== 'light'}">Light</button>
                <button @click="setTheme('dark'); mobileMenuOpen = false" class="block w-full text-left px-3 py-2 rounded-md text-base font-medium" :class="{'text-slate-900': currentTheme === 'light', 'text-white': currentTheme !== 'light'}">Dark</button>
                <button @click="setTheme('cute'); mobileMenuOpen = false" class="block w-full text-left px-3 py-2 rounded-md text-base font-medium text-pink-300" :class="{'text-slate-900': currentTheme === 'light', 'text-pink-300': currentTheme !== 'light'}">Cute Mode</button>
                <button @click="setTheme('mesi'); mobileMenuOpen = false" class="block w-full text-left px-3 py-2 rounded-md text-base font-medium text-[#FFFF00] font-black" :class="{'text-slate-900': currentTheme === 'light', 'text-[#FFFF00]': currentTheme !== 'light'}">Mesi Mode</button>
                <button @click="setTheme('rms'); mobileMenuOpen = false" class="block w-full text-left px-3 py-2 rounded-md text-base font-medium" :class="{'text-slate-900': currentTheme === 'light', 'text-white': currentTheme !== 'light'}">Ragnarok 2005</button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-8" :class="{'max-w-[95%]': currentTheme === 'rms'}">
        
        <!-- Home Section -->
        <div x-show="currentTab === 'home'" x-transition.opacity>
            <div class="text-center py-24 relative overflow-hidden rounded-xl shadow-xl mb-12 group" 
                 :class="{'bg-[#EFEFEF] border border-black mb-4 rounded-none shadow-none py-10': currentTheme === 'rms'}">
                
                <!-- Banner Background -->
                <div class="absolute inset-0 z-0">
                    <img src="banner.png" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" alt="Guild Banner" onerror="this.style.display='none'">
                    <div class="absolute inset-0 transition-colors duration-300" 
                         :class="{
                             'bg-white/80': currentTheme === 'light', 
                             'bg-black/60': currentTheme === 'dark', 
                             'bg-[#2e1065]/70': currentTheme === 'cute',
                             'bg-[#0000FF]/50': currentTheme === 'mesi',
                             'bg-[#410be1]/30': currentTheme === 'rms'
                         }"></div>
                </div>

                <div class="relative z-10" :class="{'banner-text-container': currentTheme === 'rms'}">
                    <div class="text-6xl mb-6 animate-bounce" :class="{'text-guild-accent': currentTheme !== 'rms' && currentTheme !== 'cute' && currentTheme !== 'mesi', 'text-pink-400': currentTheme === 'cute', 'text-[#FFFF00]': currentTheme === 'mesi', 'text-white text-6xl': currentTheme === 'rms'}">
                        <i class="fa-solid fa-fish"></i>
                    </div>
                    <h1 class="text-5xl font-bold mb-4" :class="{'text-slate-900': currentTheme === 'light', 'text-white': currentTheme === 'dark' || currentTheme === 'cute' || currentTheme === 'mesi'}">Welcome to Big Fish</h1>
                    <p class="text-xl max-w-2xl mx-auto mb-10" :class="{'text-slate-500': currentTheme === 'light', 'text-slate-400': currentTheme === 'dark', 'text-pink-200/80': currentTheme === 'cute', 'text-white font-bold bg-[#0000FF] inline-block px-2': currentTheme === 'mesi'}">
                        The premier hub for managing guild shenanigans, tracking gear, organizing events, and hunting MVPs.
                    </p>
                    <div class="flex justify-center gap-4">
                    <button @click="setTab('events')" 
                        :class="{
                            'bg-guild-accent hover:bg-cyan-400 text-white font-bold py-3 px-8 rounded-full shadow-lg': currentTheme === 'light', 
                            'bg-guild-accent hover:bg-cyan-400 text-guild-900 font-bold py-3 px-8 rounded-full shadow-lg': currentTheme === 'dark',
                            'bg-pink-500 hover:bg-pink-400 text-white font-bold py-3 px-8 rounded-full shadow-[0_0_15px_rgba(236,72,153,0.5)] transition-all hover:shadow-[0_0_25px_rgba(236,72,153,0.7)]': currentTheme === 'cute',
                            'bg-[#FFFF00] text-[#0000FF] border-4 border-[#FF00FF] font-black py-3 px-8 hover:bg-[#00FF00] hover:border-[#FF0000]': currentTheme === 'mesi',
                            'btn-primary px-4 py-1': currentTheme === 'rms'
                        }"
                        class="transition-transform transform hover:scale-105">
                        Join Event
                    </button>
                    <button @click="setTab('gear')" 
                        :class="{
                            'bg-slate-800 hover:bg-slate-700 text-white border-slate-600 font-bold py-3 px-8 rounded-full shadow-lg border': currentTheme === 'light',
                            'bg-guild-700 hover:bg-guild-600 text-white border-guild-600 font-bold py-3 px-8 rounded-full shadow-lg border': currentTheme === 'dark',
                            'bg-[#2a2438] hover:bg-[#362d4a] text-pink-100 border-pink-500/50 font-bold py-3 px-8 rounded-full shadow-lg border': currentTheme === 'cute',
                            'bg-[#0000FF] text-white border-4 border-[#FFFF00] font-black py-3 px-8 hover:bg-[#FF00FF] hover:text-[#FFFF00]': currentTheme === 'mesi',
                            'btn-primary px-4 py-1': currentTheme === 'rms'
                        }"
                        class="transition-transform transform hover:scale-105">
                        Track Gear
                    </button>
                    </div>
                </div>
            </div>
            
            <!-- Dashboard Widgets -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-10" :class="{'gap-2': currentTheme === 'rms'}">
                <div class="cursor-pointer card" 
                     @click="setTab('mvp')"
                     :class="getCardClass()">
                     <div :class="{'card-header': currentTheme === 'rms', 'hidden': currentTheme !== 'rms'}">Active MVPs</div>
                    <div class="p-6" :class="{'p-2 content-row': currentTheme === 'rms'}">
                        <div class="flex justify-between items-center mb-4" :class="{'hidden': currentTheme === 'rms'}">
                            <h3 class="text-lg font-semibold" :class="getTextClass()">Active MVPs</h3>
                            <i class="fa-solid fa-skull text-red-400"></i>
                        </div>
                        <div class="flex items-center justify-between">
                            <p class="text-3xl font-bold" :class="getTextClass()" x-text="activeMvps.length"></p>
                             <i class="fa-solid fa-skull text-red-600" x-show="currentTheme === 'rms'"></i>
                        </div>
                        <p class="text-sm mt-2" :class="getSubTextClass()">Bosses currently spawned</p>
                    </div>
                </div>
                
                <div class="cursor-pointer card"
                     @click="setTab('events')"
                     :class="getCardClass()">
                     <div :class="{'card-header': currentTheme === 'rms', 'hidden': currentTheme !== 'rms'}">Next Event</div>
                    <div class="p-6" :class="{'p-2 content-row': currentTheme === 'rms'}">
                        <div class="flex justify-between items-center mb-4" :class="{'hidden': currentTheme === 'rms'}">
                            <h3 class="text-lg font-semibold" :class="getTextClass()">Next Event</h3>
                            <i class="fa-solid fa-calendar-days text-yellow-400"></i>
                        </div>
                         <div class="flex items-center justify-between">
                            <p class="text-xl font-bold" :class="getTextClass()">Guild War (WoE)</p>
                            <i class="fa-solid fa-calendar-days text-blue-600" x-show="currentTheme === 'rms'"></i>
                        </div>
                        <p class="text-sm mt-2" :class="getSubTextClass()">Starts in 2h 15m</p>
                    </div>
                </div>

                <div class="cursor-pointer card"
                     @click="setTab('gear')"
                     :class="getCardClass()">
                     <div :class="{'card-header': currentTheme === 'rms', 'hidden': currentTheme !== 'rms'}">Guild Bank</div>
                    <div class="p-6" :class="{'p-2 content-row': currentTheme === 'rms'}">
                        <div class="flex justify-between items-center mb-4" :class="{'hidden': currentTheme === 'rms'}">
                            <h3 class="text-lg font-semibold" :class="getTextClass()">Guild Bank</h3>
                            <i class="fa-solid fa-coins text-yellow-500"></i>
                        </div>
                        <div class="flex items-center justify-between">
                             <p class="text-3xl font-bold" :class="getTextClass()">12.5M</p>
                             <i class="fa-solid fa-coins text-yellow-600" x-show="currentTheme === 'rms'"></i>
                        </div>
                        <p class="text-sm mt-2" :class="getSubTextClass()">Zeny Accumulated</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gear Storage Tracker -->
        <div x-show="currentTab === 'gear'" x-cloak x-transition.opacity>
            <h2 class="text-3xl font-bold mb-6 border-l-4 pl-4" 
                :class="{'text-slate-900 border-guild-accent': currentTheme === 'light', 'text-white border-guild-accent': currentTheme === 'dark', 'text-pink-100 border-pink-500 drop-shadow-[0_0_5px_rgba(236,72,153,0.5)]': currentTheme === 'cute', 'text-[#FFFF00] border-[#FF00FF] bg-[#0000FF] inline-block pr-4': currentTheme === 'mesi', 'text-[#006699] border-none pl-0 text-sm': currentTheme === 'rms'}">
                Gear Storage Tracker
            </h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8" :class="{'block gap-0': currentTheme === 'rms'}">
                <!-- Borrowed Items List -->
                <div class="lg:col-span-2 rounded-xl shadow-lg overflow-hidden border card" :class="getCardClass()">
                    <div :class="{'card-header': currentTheme === 'rms', 'hidden': currentTheme !== 'rms'}">
                        <div class="flex justify-between items-center w-full">
                            <span>Active Loans</span>
                            <button class="btn-primary px-2 py-0.5 text-[9px] border outset">New Loan</button>
                        </div>
                    </div>
                    <div class="p-4 border-b flex justify-between items-center" 
                         :class="{'border-slate-200': currentTheme === 'light', 'border-guild-700': currentTheme === 'dark', 'border-pink-500/20': currentTheme === 'cute', 'border-[#FFFF00] border-b-4': currentTheme === 'mesi', 'hidden': currentTheme === 'rms'}">
                        <h3 class="text-lg font-semibold" :class="getTextClass()">Active Loans</h3>
                        <button class="text-sm px-3 py-1 rounded transition-colors"
                                :class="{'bg-slate-200 hover:bg-slate-300 text-slate-900': currentTheme === 'light', 'bg-guild-700 hover:bg-guild-600 text-white': currentTheme === 'dark', 'bg-pink-900/30 hover:bg-pink-800/50 text-pink-100 border border-pink-500/20': currentTheme === 'cute', 'bg-[#FF0000] text-[#FFFF00] border-2 border-white hover:bg-[#00FF00] hover:text-[#0000FF] font-bold': currentTheme === 'mesi'}">
                            <i class="fa-solid fa-plus mr-1"></i> Loan Item
                        </button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm">
                            <thead class="uppercase" 
                                   :class="{'bg-slate-100 text-slate-500': currentTheme === 'light', 'bg-guild-900 text-slate-400': currentTheme === 'dark', 'bg-pink-900/20 text-pink-300 border-b border-pink-500/30': currentTheme === 'cute', 'bg-[#0000FF] text-[#FFFF00] border-4 border-[#FF00FF]': currentTheme === 'mesi', 'bg-[#006699] text-white font-bold': currentTheme === 'rms'}">
                                <tr>
                                    <th class="px-6 py-3">Item</th>
                                    <th class="px-6 py-3">Borrower</th>
                                    <th class="px-6 py-3">Date</th>
                                    <th class="px-6 py-3">Fee Status</th>
                                    <th class="px-6 py-3">Action</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y" :class="{'divide-slate-200': currentTheme === 'light', 'divide-guild-700': currentTheme === 'dark', 'divide-pink-500/20': currentTheme === 'cute', 'divide-[#FFFF00] border-4 border-[#FFFF00]': currentTheme === 'mesi', 'divide-none': currentTheme === 'rms'}">
                                <template x-for="item in gearLoans" :key="item.id">
                                    <tr class="transition-colors" :class="{'hover:bg-slate-50': currentTheme === 'light', 'hover:bg-guild-700': currentTheme === 'dark', 'hover:bg-pink-500/10': currentTheme === 'cute', 'hover:bg-[#FFFF00] hover:text-[#0000FF]': currentTheme === 'mesi'}">
                                        <td class="px-6 py-4 font-medium" :class="getTextClass()" x-text="item.name"></td>
                                        <td class="px-6 py-4" :class="currentTheme === 'dark' ? 'text-slate-300' : (currentTheme === 'cute' ? 'text-pink-200' : (currentTheme === 'mesi' ? 'text-white font-bold' : 'text-slate-700'))" x-text="item.borrower"></td>
                                        <td class="px-6 py-4" :class="getSubTextClass()" x-text="item.date"></td>
                                        <td class="px-6 py-4">
                                            <span :class="getBadgeClass(item.paid)" class="px-2 py-1 rounded-full text-xs font-bold">
                                                <span x-text="item.paid ? 'PAID' : 'PENDING'"></span>
                                            </span>
                                        </td>
                                        <td class="px-6 py-4">
                                            <button class="transition-colors" 
                                                    :class="{'text-guild-accent hover:text-sky-600': currentTheme !== 'rms' && currentTheme !== 'cute' && currentTheme !== 'mesi', 'text-pink-400 hover:text-pink-300': currentTheme === 'cute', 'text-[#FFFF00] bg-[#FF0000] px-2 border-2 border-white hover:bg-[#00FF00] hover:text-[#0000FF]': currentTheme === 'mesi', 'text-[#006699] font-bold underline text-[9px]': currentTheme === 'rms'}" 
                                                    title="Return Item">
                                                <i class="fa-solid fa-rotate-left" x-show="currentTheme !== 'rms'"></i>
                                                <span x-show="currentTheme === 'rms'">[ Return ]</span>
                                            </button>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Logic / Rules -->
                <div class="p-6 rounded-xl shadow-lg border h-fit card" :class="getCardClass()">
                    <div :class="{'card-header': currentTheme === 'rms', 'hidden': currentTheme !== 'rms'}">Fee Structure</div>
                    <h3 class="text-lg font-semibold mb-4" :class="{'hidden': currentTheme === 'rms', 'text-slate-900': currentTheme === 'light', 'text-white': currentTheme === 'dark', 'text-pink-100': currentTheme === 'cute', 'text-[#FFFF00] bg-[#FF00FF] px-2 inline-block transform -rotate-2': currentTheme === 'mesi'}">Fee Structure</h3>
                    <div class="space-y-4" :class="{'space-y-0': currentTheme === 'rms'}">
                        <div class="p-4 rounded-lg border" 
                             :class="{'bg-slate-50 border-slate-200': currentTheme === 'light', 'bg-guild-900 border-guild-700': currentTheme === 'dark', 'bg-[#1e1b2e] border-pink-500/30': currentTheme === 'cute', 'bg-[#0000FF] border-4 border-[#00FF00]': currentTheme === 'mesi', 'content-row border-none rounded-none p-2': currentTheme === 'rms'}">
                            <h4 class="font-bold mb-2" :class="{'text-guild-accent': currentTheme !== 'rms' && currentTheme !== 'cute' && currentTheme !== 'mesi', 'text-pink-400': currentTheme === 'cute', 'text-[#FFFF00] bg-[#FF0000] px-1 inline-block': currentTheme === 'mesi', 'text-[#000000]': currentTheme === 'rms'}">Active Borrower</h4>
                            <p class="text-sm" :class="getSubTextClass()">Must pay fee (AD/EDP mats, PC etc) upon borrowing high-tier items.</p>
                        </div>
                        <div class="p-4 rounded-lg border" 
                             :class="{'bg-slate-50 border-slate-200': currentTheme === 'light', 'bg-guild-900 border-guild-700': currentTheme === 'dark', 'bg-[#1e1b2e] border-pink-500/30': currentTheme === 'cute', 'bg-[#0000FF] border-4 border-[#00FF00]': currentTheme === 'mesi', 'content-row border-none rounded-none p-2': currentTheme === 'rms'}">
                            <h4 class="font-bold mb-2" :class="{'text-guild-secondary': currentTheme !== 'rms' && currentTheme !== 'cute' && currentTheme !== 'mesi', 'text-purple-400': currentTheme === 'cute', 'text-[#FFFF00] bg-[#FF0000] px-1 inline-block': currentTheme === 'mesi', 'text-[#000000]': currentTheme === 'rms'}">Active Contributor</h4>
                            <p class="text-sm" :class="getSubTextClass()">Eligible to receive payout fees from the guild bank based on contribution points.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MVP Tracker -->
        <div x-show="currentTab === 'mvp'" x-cloak x-transition.opacity>
            <div class="flex justify-between items-center mb-6" :class="{'mb-2': currentTheme === 'rms'}">
                <h2 class="text-3xl font-bold border-l-4 pl-4" 
                    :class="{'text-slate-900 border-red-500': currentTheme === 'light', 'text-white border-red-500': currentTheme === 'dark', 'text-pink-100 border-pink-600 drop-shadow-[0_0_5px_rgba(236,72,153,0.5)]': currentTheme === 'cute', 'text-[#FFFF00] border-[#FF0000] bg-[#0000FF] inline-block pr-4': currentTheme === 'mesi', 'text-[#006699] border-none pl-0 text-sm': currentTheme === 'rms'}">
                    MVP Tracker
                </h2>
                <div class="flex space-x-2">
                    <!-- Set Alerts removed (unused) -->
                    <button class="text-white px-4 py-2 rounded-lg text-sm font-medium shadow-md transition-colors"
                            :class="{'bg-slate-600 hover:bg-slate-700': currentTheme !== 'rms', 'bg-[#000000] text-[#FFFF00]': currentTheme === 'mesi'}"
                            @click="untrackAll()">
                        <i class="fa-solid fa-trash-can mr-2"></i> Untrack All
                    </button>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" :class="{'block gap-0': currentTheme === 'rms'}">
                <div class="col-span-3 mb-2" x-show="currentTheme === 'rms'">
                    <div class="card">
                        <div class="card-header">MVP Status List</div>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr>
                                        <th>MVP Name</th>
                                        <th>Map</th>
                                        <th>Status</th>
                                        <th>Respawn</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <template x-for="(mvp, idx) in activeMvps" :key="idx + '-' + mvp.id + '-' + (mvp.map || '')">
                                        <tr>
                                            <td class="font-bold">
                                                <a :href="`https://ratemyserver.net/index.php?page=mob_db&mob_id=${mvp.id}`" 
                                                   target="_blank" 
                                                   class="text-[#006699] underline hover:text-[#003366]"
                                                   x-text="mvp.name"></a>
                                            </td>
                                            <td x-text="mvp.map"></td>
                                            <td class="text-center"><span x-text="mvp.status" class="font-bold uppercase" :class="mvp.status === 'alive' ? 'text-[green]' : 'text-[red]'"></span></td>
                                            <td class="text-center font-bold" x-text="mvp.respawnTime"></td>
                                            <td class="text-center">
                                                <button class="btn-primary px-1" @click="removeActiveMvp(idx)">[ Untrack ]</button>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Grid Cards (Hidden in RMS mode) -->
                <template x-for="(mvp, idx) in activeMvps" :key="idx + '-' + mvp.id + '-' + (mvp.map || '')">
                    <div class="rounded-xl overflow-hidden shadow-lg border group transition-all duration-300 relative p-4 min-h-[360px] flex flex-col"
                         x-show="currentTheme !== 'rms'"
                         :class="{'bg-white border-slate-200 hover:border-red-500': currentTheme === 'light', 'bg-black border-slate-800 hover:border-red-500': currentTheme === 'dark', 'bg-[#2a2438] border-pink-500/20 hover:border-pink-400 hover:shadow-[0_0_20px_rgba(236,72,153,0.3)]': currentTheme === 'cute', 'bg-[#0000FF] border-4 border-[#FFFF00] rounded-none shadow-none': currentTheme === 'mesi'}">
                        
                          <!-- Top Gradient for Cute Mode (Black -> Transparent) -->
                        <div class="absolute top-0 inset-x-0 h-80 bg-gradient-to-b from-black to-transparent pointer-events-none z-5"
                        x-show="currentTheme === 'cute'"></div>
                        
                        <!-- MVP Sprite from iRO Wiki (z-10) -->
                        <img :src="`https://db.irowiki.org/image/monster/${mvp.id}.png`" 
                             :alt="mvp.name"
                             class="pixelated absolute z-10"
                             style="image-rendering: pixelated; image-rendering: -moz-crisp-edges; image-rendering: crisp-edges; max-height: 68px; left: 70%; top: 45%; transform: translate(-50%, -50%) scale(2.5);"
                             @error="$event.target.style.display='none'">
                        
                        <!-- Gradient overlay (z-20) - higher gradient -->
                        <div class="absolute inset-x-0 pointer-events-none z-20" 
                             :class="{'top-0 h-32 bg-gradient-to-b from-slate-300 to-transparent': currentTheme === 'light', 'bottom-0 h-[28rem] bg-gradient-to-t from-slate-900 to-transparent': currentTheme === 'dark', 'bottom-0 h-[28rem] bg-gradient-to-t from-[#2a2438] to-transparent': currentTheme === 'cute'}"></div>

                       
                        
                        <!-- Status badge (z-30) -->
                        <div class="absolute top-2 right-2 z-30">
                            <span :class="getStatusColor(mvp.status)" class="px-2 py-1 rounded text-xs font-bold uppercase" x-text="mvp.status"></span>
                        </div>
                        
                        <!-- Spacer to push content to bottom -->
                        <div class="flex-grow"></div>
                        
                        <!-- Bottom content anchored -->
                        <div class="z-30 relative">
                            <!-- MVP Name -->
                            <div class="mb-2">
                                <a :href="`https://ratemyserver.net/index.php?page=mob_db&mob_id=${mvp.id}`" 
                                   target="_blank"
                                   class="text-xl font-bold transition-colors hover:underline text-white group-hover:text-red-400" 
                                   x-text="mvp.name"></a>
                                <div class="text-xs mt-1" :class="getSubTextClass()">ID: <span x-text="mvp.id"></span></div>
                            </div>
                            
                            <!-- Map & Location -->
                            <div class="mb-3">
                                <p class="text-xs uppercase" :class="getSubTextClass()">Map & Location</p>
                                <p class="text-sm font-medium" :class="getTextClass()" x-text="mvp.map"></p>
                                <p class="text-xs" :class="getSubTextClass()" x-text="mvp.coords"></p>
                            </div>
                            
                            <!-- Respawn Countdown -->
                            <div class="mb-3">
                                <p class="text-sm font-bold" :class="{'text-guild-accent': currentTheme !== 'rms' && currentTheme !== 'cute' && currentTheme !== 'mesi', 'text-pink-400': currentTheme === 'cute', 'text-[#FFFF00] bg-[#FF00FF] px-1 inline-block': currentTheme === 'mesi'}" x-text="mvp.respawnTime"></p>
                            </div>

                            <!-- Respawn Window -->
                            <div class="mb-3">
                                <p class="text-xs uppercase" :class="getSubTextClass()">Respawn Window</p>
                                <p class="text-xs" :class="getSubTextClass()" x-text="getMvpRespawnInfo(mvp.id)"></p>
                            </div>
                            
                            <!-- Report Kill Button -->
                            <button class="w-full py-2 rounded transition-colors text-sm font-medium"
                                    :class="{'bg-slate-100 hover:bg-red-500 hover:text-white text-slate-700': currentTheme === 'light', 'bg-slate-700 hover:bg-red-600 text-slate-200': currentTheme === 'dark', 'bg-pink-900/30 hover:bg-pink-500 hover:text-white text-pink-200 border border-pink-500/20': currentTheme === 'cute', 'bg-[#FF00FF] text-[#FFFF00] border-4 border-[#00FF00] font-black hover:bg-[#FFFF00] hover:text-[#FF0000] hover:border-[#000000]': currentTheme === 'mesi'}"
                                    @click="removeActiveMvp(idx)">
                                Untrack
                            </button>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <!-- All MVPs (browse & track) -->
        <div class="mt-8" x-show="currentTab === 'mvp'">
            <h3 class="text-2xl font-bold mb-4" :class="getTextClass()">All MVPs</h3>
            <div class="flex justify-center mb-4">
                <div class="w-full max-w-2xl flex items-center gap-3">
                    <div class="relative w-full">
                        <input x-ref="mvpSearchInput" type="search" placeholder="Search by name or ID" x-model="mvpSearch" class="w-full px-3 py-2 rounded border" :class="getCardClass()" />
                        <button type="button" title="Clear search" @click="mvpSearch=''; $refs.mvpSearchInput.focus()" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-sm px-2 py-1 rounded bg-slate-200 dark:bg-guild-700">
                            ✕
                        </button>
                    </div>
                    <div class="flex items-center gap-2">
                        <label class="text-sm" :class="getSubTextClass()">Sort</label>
                        <select x-model="mvpSortBy" class="px-2 py-1 rounded border" :class="getCardClass()">
                            <option value="name">Name</option>
                            <option value="id">ID</option>
                        </select>
                        <select x-model="mvpSortDir" class="px-2 py-1 rounded border" :class="getCardClass()">
                            <option value="asc">Asc</option>
                            <option value="desc">Desc</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                <template x-for="m in filteredAll()" :key="`all-mvp-${m.id}`">
                    <div class="rounded-xl overflow-hidden shadow-lg border group transition-all duration-300 relative p-4 min-h-[360px] flex flex-col"
                         :class="{'bg-white border-slate-200 hover:border-red-500': currentTheme === 'light', 'bg-black border-slate-800 hover:border-red-500': currentTheme === 'dark', 'bg-[#2a2438] border-pink-500/20 hover:border-pink-400 hover:shadow-[0_0_20px_rgba(236,72,153,0.3)]': currentTheme === 'cute', 'bg-[#0000FF] border-4 border-[#FFFF00] rounded-none shadow-none': currentTheme === 'mesi'}">

                        <!-- Top Gradient for Cute Mode -->
                        <div class="absolute top-0 inset-x-0 h-80 bg-gradient-to-b from-black to-transparent pointer-events-none z-5" x-show="currentTheme === 'cute'"></div>

                        <!-- MVP Sprite from iRO Wiki (same as active) -->
                        <img :src="`https://db.irowiki.org/image/monster/${m.id}.png`"
                             :alt="m.name"
                             class="pixelated absolute z-10"
                             style="image-rendering: pixelated; image-rendering: -moz-crisp-edges; image-rendering: crisp-edges; max-height: 68px; left: 70%; top: 45%; transform: translate(-50%, -50%) scale(2.5);"
                             @error="$event.target.style.display='none'">

                        <!-- Gradient overlay (match active card) -->
                        <div class="absolute inset-x-0 pointer-events-none z-20"
                             :class="{'top-0 h-32 bg-gradient-to-b from-slate-300 to-transparent': currentTheme === 'light', 'bottom-0 h-[28rem] bg-gradient-to-t from-slate-900 to-transparent': currentTheme === 'dark', 'bottom-0 h-[28rem] bg-gradient-to-t from-[#2a2438] to-transparent': currentTheme === 'cute'}"></div>

                        <!-- Status badge -->
                        <div class="absolute top-2 right-2 z-30">
                            <span :class="getTrackedStatusClass(m)" class="px-2 py-1 rounded text-xs font-bold uppercase" x-text="getTrackedStatusText(m)"></span>
                        </div>

                        <div class="flex-grow"></div>

                        <div class="z-30 relative">
                            <!-- MVP Name -->
                            <div class="mb-2">
                                <a :href="`https://ratemyserver.net/index.php?page=mob_db&mob_id=${m.id}`"
                                   target="_blank"
                                   class="text-xl font-bold transition-colors hover:underline text-white group-hover:text-red-400"
                                   x-text="m.name"></a>
                                <div class="text-xs mt-1" :class="getSubTextClass()">ID: <span x-text="m.id"></span></div>
                            </div>

                            <!-- Map & Location: show single spawn or 'Multiple spawns — click Report' -->
                            <div class="mb-3">
                                <p class="text-xs uppercase" :class="getSubTextClass()">Map & Location</p>
                                <template x-if="m.spawns && m.spawns.length === 1 && !m.spawns[0].coordsList">
                                    <p class="text-sm font-medium" :class="getTextClass()" x-text="m.spawns[0].map"></p>
                                    <p class="text-xs" :class="getSubTextClass()" x-text="(m.spawns[0].x !== undefined ? '(' + m.spawns[0].x + ', ' + m.spawns[0].y + ')' : 'Random')"></p>
                                </template>
                                <template x-if="m.spawns && m.spawns.length === 1 && m.spawns[0].coordsList">
                                    <p class="text-sm font-medium" :class="getTextClass()" x-text="m.spawns[0].map"></p>
                                    <p class="text-xs" :class="getSubTextClass()">Can spawn on: <span x-text="getCoordsText(m.spawns[0])"></span></p>
                                </template>
                                <template x-if="!m.spawns || m.spawns.length === 0">
                                    <p class="text-sm font-medium" :class="getTextClass()">Unknown</p>
                                </template>
                            </div>

                            <!-- Respawn Window -->
                            <div class="mb-3">
                                <p class="text-xs uppercase" :class="getSubTextClass()">Respawn Window</p>
                                <p class="text-sm font-bold" :class="{'text-guild-accent': currentTheme !== 'rms' && currentTheme !== 'cute' && currentTheme !== 'mesi', 'text-pink-400': currentTheme === 'cute', 'text-[#FFFF00] bg-[#FF00FF] px-1 inline-block': currentTheme === 'mesi'}" x-text="getMvpRespawnInfo(m.id)"></p>
                                <p class="text-xs" :class="getSubTextClass()">&nbsp;</p>
                            </div>

                            <!-- Report Kill Button -->
                                <button class="w-full py-2 rounded transition-colors text-sm font-medium"
                                    :class="{'bg-slate-100 hover:bg-red-500 hover:text-white text-slate-700': currentTheme === 'light', 'bg-slate-700 hover:bg-red-600 text-slate-200': currentTheme === 'dark', 'bg-pink-900/30 hover:bg-pink-500 hover:text-white text-pink-200 border border-pink-500/20': currentTheme === 'cute', 'bg-[#FF00FF] text-[#FFFF00] border-4 border-[#00FF00] font-black hover:bg-[#FFFF00] hover:text-[#FF0000] hover:border-[#000000]': currentTheme === 'mesi'}"
                                    :disabled="((m.spawns && m.spawns.length === 1) ? isTrackedOnMap(m.id, m.spawns[0].map) : false) || (isBioLab3Id(m.id) && isAnyBioLab3Tracked() && !isTracked(m))"
                                    @click="addMvpToTracker(m.id, true)">
                                Report Kill
                            </button>
                        </div>
                    </div>
                </template>
            </div>

            <!-- Spawn selection modal -->
            <div x-show="spawnSelection.open" x-cloak class="fixed inset-0 z-50 flex items-center justify-center">
                <div class="absolute inset-0 bg-black/50 z-40" @click.self="spawnSelection.open = false"></div>
                <div class="bg-white dark:bg-guild-800 rounded-lg p-6 z-50 max-w-lg w-full" :class="getCardClass()" @click.stop>
                    <h4 class="text-lg font-bold mb-3" :class="getTextClass()">Select spawn for <span x-text="spawnSelection.mvpName"></span></h4>
                    <div class="space-y-2 max-h-64 overflow-y-auto">
                            <template x-for="choice in spawnSelection.choices" :key="choice.index">
                            <div class="flex justify-between items-center p-2 border rounded" :class="getCardClass()">
                                <div>
                                    <div class="font-semibold" x-text="choice.map"></div>
                                    <div class="text-xs" :class="getSubTextClass()" x-text="choice.coords"></div>
                                </div>
                                <div>
                                    <button class="btn-primary px-3 py-1" @click.stop="confirmSpawnSelection(choice)">Select</button>
                                </div>
                            </div>
                        </template>
                    </div>
                    <div class="mt-4 text-right">
                        <button class="px-3 py-1" @click="spawnSelection.open = false">Cancel</button>
                    </div>
                </div>
            </div>

                <!-- Toasts -->
                <div class="fixed top-[60px] left-1/2 transform -translate-x-1/2 space-y-2 w-full max-w-md px-4" style="z-index:9999;" aria-live="polite">
                    <template x-for="t in toasts" :key="t.id">
                        <div x-cloak x-show="t.visible" x-transition class="max-w-sm w-full rounded shadow-lg p-3 flex items-start space-x-3" :class="t.type === 'success' ? 'bg-green-700 text-white' : t.type === 'warning' ? 'bg-yellow-600 text-black' : 'bg-slate-800 text-white'">
                            <div class="flex-1">
                                <div class="font-semibold" x-text="t.title || (t.type === 'warning' ? 'Warning' : (t.type === 'success' ? 'Success' : 'Info'))"></div>
                                <div class="text-sm" x-text="t.message"></div>
                            </div>
                            <div class="ml-2">
                                <button class="px-2 py-1" @click="removeToast(t.id)">✕</button>
                            </div>
                        </div>
                    </template>
                </div>

                <!-- Confirm modal (non-blocking) -->
                <div x-show="confirmDialog.open" x-cloak class="fixed inset-0 z-50 flex items-center justify-center">
                    <div class="absolute inset-0 bg-black/50" @click.self="confirmDialog.open = false"></div>
                    <div class="bg-white dark:bg-guild-800 rounded-lg p-6 z-50 max-w-md w-full" :class="getCardClass()" @click.stop>
                        <h4 class="text-lg font-bold mb-2" :class="getTextClass()" x-text="confirmDialog.title"></h4>
                        <p class="mb-4" :class="getSubTextClass()" x-text="confirmDialog.message"></p>
                        <div class="flex justify-end space-x-2">
                            <button class="px-3 py-1" @click="confirmDialog.open = false">Cancel</button>
                            <button class="px-3 py-1 btn-primary" @click="(confirmDialog.onConfirm && confirmDialog.onConfirm()); confirmDialog.open = false">Confirm</button>
                        </div>
                    </div>
                </div>

        </div>

        <!-- Events Section -->
        <div x-show="currentTab === 'events'" x-cloak x-transition.opacity>
             <h2 class="text-3xl font-bold mb-6 border-l-4 pl-4" 
                 :class="{'text-slate-900 border-yellow-500': currentTheme === 'light', 'text-white border-yellow-500': currentTheme === 'dark', 'text-pink-100 border-purple-400 drop-shadow-[0_0_5px_rgba(192,132,252,0.5)]': currentTheme === 'cute', 'text-[#FFFF00] border-[#00FF00] bg-[#0000FF] inline-block pr-4': currentTheme === 'mesi', 'text-[#006699] border-none pl-0 text-sm': currentTheme === 'rms'}">
                 Events & Voting
            </h2>

             <div class="grid grid-cols-1 lg:grid-cols-3 gap-8" :class="{'block gap-0': currentTheme === 'rms'}">
                <!-- Upcoming Events -->
                <div class="lg:col-span-2 space-y-6" :class="{'space-y-0': currentTheme === 'rms'}">
                    <h3 class="text-xl font-semibold" :class="{'hidden': currentTheme === 'rms', 'text-slate-900': currentTheme === 'light', 'text-white': currentTheme === 'dark'}">Upcoming Events</h3>
                    
                    <!-- RMS Style Events -->
                     <div class="card" x-show="currentTheme === 'rms'">
                        <div class="card-header">Upcoming Events</div>
                        <template x-for="event in events" :key="`rms-event-${event.id}`">
                             <div class="content-row">
                                 <div class="flex justify-between">
                                     <div class="font-bold text-[#006699]" x-text="event.title"></div>
                                     <div class="text-xs" x-text="`${event.month} ${event.day} @ ${event.time}`"></div>
                                 </div>
                                 <div class="my-1" x-text="event.description"></div>
                                 <div class="text-[10px] mb-1">
                                     <b>Roles:</b> 
                                     <template x-for="role in event.roles">
                                         <span x-text="`${role.name} (${role.filled}/${role.needed}) `"></span>
                                     </template>
                                 </div>
                                 <div class="text-right">
                                     <button class="btn-primary px-2 text-[9px]">[ Sign Up ]</button>
                                 </div>
                             </div>
                        </template>
                     </div>

                    <!-- Modern Style Events -->
                    <template x-for="event in events" :key="event.id">
                        <div class="rounded-xl p-6 border shadow-lg flex flex-col sm:flex-row gap-6 card" 
                             x-show="currentTheme !== 'rms'"
                             :class="getCardClass()">
                            <div class="rounded-lg p-4 flex flex-col items-center justify-center min-w-[100px] border text-center"
                                 :class="{'bg-slate-50 border-slate-200': currentTheme === 'light', 'bg-guild-900 border-guild-700': currentTheme === 'dark', 'bg-[#1e1b2e] border-pink-500/30': currentTheme === 'cute', 'bg-[#0000FF] border-4 border-[#FF0000]': currentTheme === 'mesi'}">
                                <span class="font-bold text-lg" :class="{'text-red-500': currentTheme === 'light', 'text-red-400': currentTheme === 'dark', 'text-pink-400': currentTheme === 'cute', 'text-[#FFFF00]': currentTheme === 'mesi'}" x-text="event.month"></span>
                                <span class="text-4xl font-bold my-1" :class="getTextClass()" x-text="event.day"></span>
                                <span class="text-sm" :class="getSubTextClass()" x-text="event.time"></span>
                            </div>
                            <div class="flex-grow">
                                <h4 class="text-2xl font-bold mb-2" :class="getTextClass()" x-text="event.title"></h4>
                                <p class="mb-4" :class="getSubTextClass()" x-text="event.description"></p>
                                
                                <div class="mb-4">
                                    <p class="text-sm font-semibold mb-2" :class="{'text-guild-accent': currentTheme !== 'rms' && currentTheme !== 'cute' && currentTheme !== 'mesi', 'text-pink-300': currentTheme === 'cute', 'text-[#FFFF00] bg-[#FF00FF] inline-block px-1': currentTheme === 'mesi'}">Required Roles:</p>
                                    <div class="flex flex-wrap gap-2">
                                        <template x-for="role in event.roles" :key="role.name">
                                            <span :class="getRoleBadgeClass(role.filled, role.needed)" class="px-3 py-1 rounded-full text-xs border flex items-center gap-2">
                                                <span x-text="role.name"></span>
                                                <span class="font-bold" x-text="`${role.filled}/${role.needed}`"></span>
                                            </span>
                                        </template>
                                    </div>
                                </div>

                                <div class="flex gap-3">
                                    <button class="font-bold py-2 px-6 rounded-lg transition-colors"
                                            :class="{'bg-guild-accent hover:bg-cyan-400 text-white': currentTheme === 'light', 'bg-guild-accent hover:bg-cyan-400 text-guild-900': currentTheme === 'dark', 'bg-pink-500 hover:bg-pink-400 text-white shadow-[0_0_10px_rgba(236,72,153,0.4)]': currentTheme === 'cute', 'bg-[#00FF00] text-[#0000FF] border-4 border-[#FFFF00] hover:bg-[#FFFF00] hover:text-[#FF0000]': currentTheme === 'mesi'}">
                                        Sign Up
                                    </button>
                                    <button class="font-medium py-2 px-4 rounded-lg transition-colors"
                                            :class="{'bg-slate-200 hover:bg-slate-300 text-slate-900': currentTheme === 'light', 'bg-guild-700 hover:bg-guild-600 text-white': currentTheme === 'dark', 'bg-pink-900/30 hover:bg-pink-800/50 text-pink-100 border border-pink-500/20': currentTheme === 'cute', 'bg-[#FF00FF] text-[#FFFF00] border-4 border-[#00FF00] hover:bg-[#0000FF] hover:text-white': currentTheme === 'mesi'}">
                                        Details
                                    </button>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>

                <!-- Voting / Polls -->
                <div class="rounded-xl p-6 border shadow-lg h-fit card" 
                     :class="getCardClass()"
                     x-show="currentTheme !== 'rms'">
                     <!-- Modern Polls (hidden in RMS and replaced) -->
                    <h3 class="text-xl font-semibold mb-4 flex items-center gap-2" :class="getTextClass()">
                        <i class="fa-solid fa-check-to-slot" :class="{'text-guild-secondary': currentTheme !== 'rms' && currentTheme !== 'cute' && currentTheme !== 'mesi', 'text-pink-400': currentTheme === 'cute', 'text-[#00FF00]': currentTheme === 'mesi'}"></i> Active Polls
                    </h3>
                    <div class="space-y-6">
                        <template x-for="poll in polls" :key="poll.id">
                            <div class="p-4 rounded-lg border" :class="{'bg-slate-50 border-slate-200': currentTheme === 'light', 'bg-guild-900 border-guild-700': currentTheme === 'dark', 'bg-[#1e1b2e] border-pink-500/30': currentTheme === 'cute', 'bg-[#0000FF] border-4 border-[#FF00FF]': currentTheme === 'mesi'}">
                                <h4 class="font-bold mb-3" :class="getTextClass()" x-text="poll.question"></h4>
                                <div class="space-y-3">
                                    <template x-for="option in poll.options" :key="option.id">
                                        <div class="relative">
                                            <div class="flex justify-between text-xs mb-1" :class="getSubTextClass()">
                                                <span x-text="option.label"></span>
                                                <span x-text="`${option.percent}%`"></span>
                                            </div>
                                            <div class="w-full rounded-full h-2.5 cursor-pointer transition-colors" 
                                                 :class="{'bg-slate-200 hover:bg-slate-300': currentTheme === 'light', 'bg-guild-800 hover:bg-guild-700': currentTheme === 'dark', 'bg-pink-900/20 hover:bg-pink-900/40': currentTheme === 'cute', 'bg-[#FF0000] rounded-none border border-white': currentTheme === 'mesi'}"
                                                 @click="vote(poll.id, option.id)">
                                                <div class="h-2.5 rounded-full transition-all duration-500" 
                                                     :class="{'bg-guild-secondary': currentTheme !== 'rms' && currentTheme !== 'cute' && currentTheme !== 'mesi', 'bg-pink-500': currentTheme === 'cute', 'bg-[#FFFF00] rounded-none': currentTheme === 'mesi'}"
                                                     :style="`width: ${option.percent}%`"></div>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                                <p class="text-xs mt-3 text-right" :class="getSubTextClass()" x-text="`${poll.votes} votes total`"></p>
                            </div>
                        </template>
                    </div>
                </div>
                
                <!-- RMS Polls -->
                <div class="card" x-show="currentTheme === 'rms'">
                    <div class="card-header">Active Polls</div>
                    <template x-for="poll in polls" :key="`rms-poll-${poll.id}`">
                        <div class="content-row">
                            <b x-text="poll.question"></b>
                            <ul class="list-disc list-inside ml-2">
                                <template x-for="option in poll.options">
                                    <li x-text="`${option.label} - ${option.percent}%`"></li>
                                </template>
                            </ul>
                            <div class="text-right text-[9px] mt-1">
                                <a href="#" class="text-[#006699] underline">[ Vote Now ]</a>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="border-t py-6 mt-12"
            :class="{'bg-white border-slate-200': currentTheme === 'light', 'bg-guild-900 border-guild-800': currentTheme === 'dark', 'bg-[#2a2438] border-pink-500/20': currentTheme === 'cute', 'bg-[#0000FF] border-t-4 border-[#FFFF00]': currentTheme === 'mesi', 'bg-[#E5E5E5] border-none py-4 mt-4': currentTheme === 'rms'}">
        <div class="container mx-auto px-4 text-center text-sm" :class="getSubTextClass()">
            <p x-text="currentTheme === 'rms' ? 'Powered by BigFish v1.0.0 © 2005' : '&copy; 2025 Big Fish Guild. All Shenanigans Reserved.'"></p>
            <div class="mt-2 space-x-4" x-show="currentTheme !== 'rms'">
                <a href="#" class="hover:text-guild-accent transition-colors" :class="{'hover:text-pink-400': currentTheme === 'cute', 'text-[#FFFF00] hover:text-[#FF00FF] bg-black px-1': currentTheme === 'mesi'}"><i class="fa-brands fa-discord"></i> Discord</a>
                <a href="#" class="hover:text-guild-accent transition-colors" :class="{'hover:text-pink-400': currentTheme === 'cute', 'text-[#FFFF00] hover:text-[#FF00FF] bg-black px-1': currentTheme === 'mesi'}"><i class="fa-brands fa-twitter"></i> Twitter</a>
            </div>
            <div class="mt-2 text-[10px]" x-show="currentTheme === 'rms'">
                 [ <a href="#" class="text-[#006699] underline">Admin CP</a> ] [ <a href="#" class="text-[#006699] underline">Mod CP</a> ]
            </div>
        </div>
    </footer>

    <script>
        function app() {
            return {
                currentTab: 'home',
                mobileMenuOpen: false,
                currentTheme: 'dark',
                serverTime: '',
                localTime: '',
                
                init() {
                    // Restore saved tab
                    const savedTab = localStorage.getItem('currentTab');
                    if (savedTab) {
                        this.currentTab = savedTab;
                    }
                    
                    // Check for saved theme, default to dark
                    const savedTheme = localStorage.getItem('theme');
                    if (savedTheme) {
                        this.currentTheme = savedTheme;
                    } else {
                        // Default to dark mode
                        this.currentTheme = 'dark';
                    }
                    this.applyTheme();
                    // Build the full MVP list from the database
                    this.buildAllMvps();
                    // Load persisted active trackers from localStorage
                    this.loadActiveMvps();
                    
                    // Clock
                    this.updateTime();
                    setInterval(() => this.updateTime(), 1000);
                    // Respawn ticker (updates countdowns)
                    this.startRespawnTicker();
                },
                
                updateTime() {
                    const now = new Date();
                    this.localTime = now.toLocaleTimeString();
                    this.serverTime = now.toLocaleTimeString('en-US', { timeZone: 'UTC', hour12: false });
                },

                setTab(tabId) {
                    this.currentTab = tabId;
                    localStorage.setItem('currentTab', tabId);
                    // Proactively request Notification permission the first time the user opens the MVP tracker
                    if (tabId === 'mvp') {
                        try { this.requestNotificationsIfNeeded(); } catch (e) { /* ignore */ }
                    }
                },

                // Request browser Notification permission once (saved in localStorage)
                requestNotificationsIfNeeded() {
                    try {
                        if (!('Notification' in window)) return;
                        const flag = localStorage.getItem('bigfish_notif_request_v1');
                        if (flag) return; // already requested
                        // If already granted or denied, store a flag but still notify user of blocked state
                        if (Notification.permission === 'granted') {
                            localStorage.setItem('bigfish_notif_request_v1', '1');
                            this.showToast('Notifications are already enabled', 'success');
                            return;
                        }
                        if (Notification.permission === 'denied') {
                            localStorage.setItem('bigfish_notif_request_v1', '1');
                            this.showToast('Browser notifications are blocked — enable in browser settings to receive alerts', 'warning');
                            return;
                        }
                        // permission is 'default' — ask the user (browser prompt)
                        Notification.requestPermission().then(p => {
                            localStorage.setItem('bigfish_notif_request_v1', '1');
                            if (p === 'granted') {
                                this.showToast('Notifications enabled', 'success');
                            } else {
                                this.showToast('Notifications denied or dismissed', 'warning');
                            }
                        }).catch(() => {
                            localStorage.setItem('bigfish_notif_request_v1', '1');
                        });
                    } catch (e) {
                        console.warn('requestNotificationsIfNeeded failed', e);
                    }
                },

                setTheme(theme) {
                    this.currentTheme = theme;
                    this.applyTheme();
                },

                applyTheme() {
                    // Remove dark class primarily used for Tailwind's 'dark:' modifier
                    if (this.currentTheme === 'dark') {
                        document.documentElement.classList.add('dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                    }
                    localStorage.setItem('theme', this.currentTheme);
                },
                
                // Dynamic classes helper functions to keep HTML cleaner
                getNavClass(tabId) {
                    const isActive = this.currentTab === tabId;
                    if (this.currentTheme === 'light') {
                        return isActive ? 'bg-slate-100 text-slate-900' : 'text-slate-500 hover:bg-slate-100 hover:text-slate-900';
                    } else if (this.currentTheme === 'dark') {
                        return isActive ? 'bg-guild-700 text-white' : 'text-slate-400 hover:bg-guild-700 hover:text-white';
                    } else if (this.currentTheme === 'cute') {
                        return isActive ? 'bg-pink-500/20 text-pink-100 border border-pink-500/30' : 'text-pink-300/70 hover:bg-pink-500/10 hover:text-pink-200';
                    } else if (this.currentTheme === 'mesi') {
                        return isActive ? 'bg-[#FFFF00] text-[#0000FF] font-black border-4 border-[#FF00FF]' : 'text-white hover:bg-[#FFFF00] hover:text-[#0000FF] font-bold border-4 border-transparent hover:border-[#FF00FF]';
                    } else { // RMS
                        return isActive ? 'active' : '';
                    }
                },
                getCardClass() {
                    if (this.currentTheme === 'light') return 'bg-white border-slate-200 hover:border-guild-accent transition-colors';
                    if (this.currentTheme === 'dark') return 'bg-guild-800 border-guild-700 hover:border-guild-accent transition-colors';
                    if (this.currentTheme === 'cute') return 'bg-[#2a2438] border-pink-500/20 hover:border-pink-400/50 hover:shadow-[0_0_15px_rgba(236,72,153,0.15)] transition-all duration-300';
                    if (this.currentTheme === 'mesi') return 'bg-[#0000FF] border-4 border-[#FFFF00] shadow-none rounded-none';
                    return 'theme-rms-card'; // Handled by CSS
                },
                getTextClass() {
                    if (this.currentTheme === 'light') return 'text-slate-900';
                    if (this.currentTheme === 'dark') return 'text-white';
                    if (this.currentTheme === 'cute') return 'text-pink-50';
                    if (this.currentTheme === 'mesi') return 'text-[#FFFF00] font-black tracking-tighter';
                    return 'text-[#000000]';
                },
                getSubTextClass() {
                    if (this.currentTheme === 'light') return 'text-slate-500';
                    if (this.currentTheme === 'dark') return 'text-slate-400';
                    if (this.currentTheme === 'cute') return 'text-pink-200/60';
                    if (this.currentTheme === 'mesi') return 'text-white font-bold';
                    return 'text-[#000000]';
                },
                getBadgeClass(paid) {
                    if (paid) {
                         if (this.currentTheme === 'dark') return 'bg-green-900 text-green-300';
                         if (this.currentTheme === 'light') return 'bg-green-100 text-green-800';
                         if (this.currentTheme === 'cute') return 'bg-emerald-900/40 text-emerald-200 border border-emerald-500/20';
                         if (this.currentTheme === 'mesi') return 'bg-[#00FF00] text-[#0000FF] border-4 border-[#FF00FF]';
                         return 'text-[green] font-bold';
                    } else {
                         if (this.currentTheme === 'dark') return 'bg-red-900 text-red-300';
                         if (this.currentTheme === 'light') return 'bg-red-100 text-red-800';
                         if (this.currentTheme === 'cute') return 'bg-rose-900/40 text-rose-200 border border-rose-500/20';
                         if (this.currentTheme === 'mesi') return 'bg-[#FF0000] text-[#FFFF00] border-4 border-[#000000] animate-pulse';
                         return 'text-[red] font-bold';
                    }
                },
                getStatusColor(status) {
                    if (status === 'alive') {
                        if (this.currentTheme === 'dark') return 'bg-green-900 text-green-300 border border-green-700';
                        if (this.currentTheme === 'light') return 'bg-green-100 text-green-800 border border-green-200';
                        if (this.currentTheme === 'cute') return 'bg-emerald-900/30 text-emerald-200 border border-emerald-500/30 shadow-[0_0_10px_rgba(16,185,129,0.2)]';
                        if (this.currentTheme === 'mesi') return 'bg-[#00FF00] text-[#0000FF] border-4 border-[#FFFF00] font-black text-xl';
                        return 'text-[green] font-bold';
                    } else {
                        if (this.currentTheme === 'dark') return 'bg-red-900 text-red-300 border border-red-700 opacity-60';
                        if (this.currentTheme === 'light') return 'bg-red-100 text-red-800 border border-red-200 opacity-60';
                        if (this.currentTheme === 'cute') return 'bg-rose-900/30 text-rose-300 border border-rose-500/30 opacity-60';
                        if (this.currentTheme === 'mesi') return 'bg-[#FF00FF] text-[#FFFF00] border-4 border-[#00FF00] line-through decoration-4 decoration-white';
                        return 'text-[red] font-bold';
                    }
                },
                getRoleBadgeClass(filled, needed) {
                    const isFull = filled >= needed;
                    if (isFull) {
                        if (this.currentTheme === 'dark') return 'bg-green-900 text-green-300 border-green-700';
                        if (this.currentTheme === 'light') return 'bg-green-100 text-green-800 border-green-200';
                        if (this.currentTheme === 'cute') return 'bg-emerald-900/30 text-emerald-200 border-emerald-500/30';
                        if (this.currentTheme === 'mesi') return 'bg-[#00FF00] text-[#0000FF] border-4 border-[#FFFF00]';
                        return 'text-[green] font-bold';
                    } else {
                        if (this.currentTheme === 'dark') return 'bg-guild-900 text-slate-300 border-guild-600';
                        if (this.currentTheme === 'light') return 'bg-slate-100 text-slate-700 border-slate-200';
                        if (this.currentTheme === 'cute') return 'bg-[#1e1b2e] text-pink-200/70 border-pink-500/20';
                        if (this.currentTheme === 'mesi') return 'bg-[#0000FF] text-[#FFFF00] border-4 border-[#FF0000]';
                        return 'text-[#000000]';
                    }
                },

                tabs: [
                    { id: 'home', label: 'Home' },
                    { id: 'gear', label: 'Gear Storage' },
                    { id: 'mvp', label: 'MVP Tracker' },
                    { id: 'events', label: 'Events' }
                ],
                // Mock Data
                gearLoans: [
                    { id: 1, name: '+10 Pike [4]', borrower: 'xX_Slayer_Xx', date: '2025-05-12', paid: true },
                    { id: 2, name: 'Ghostring Card', borrower: 'HealerPls', date: '2025-05-14', paid: false },
                    { id: 3, name: 'Mjollnir', borrower: 'GuildLeader', date: '2025-05-10', paid: true },
                    { id: 4, name: 'Valkyrie Shield', borrower: 'TankBoii', date: '2025-05-15', paid: false },
                ],
                // MVP Database - Complete data from Discord bot
                mvpDatabase: {
                    1511: { name: 'Amon Ra', spawns: [{ map: 'moc_pryd06', x: 102, y: 85, delay: 60, variance: 10 }] },
                    1785: { name: 'Atroce', spawns: [
                        { map: 'ra_fild02', delay: 240, variance: 10 },
                        { map: 'ra_fild03', delay: 180, variance: 10 },
                        { map: 'ra_fild04', delay: 300, variance: 10 },
                        { map: 've_fild01', delay: 180, variance: 10 },
                        { map: 've_fild02', x: 120, y: 55, delay: 360, variance: 10 }
                    ]},
                    1039: { name: 'Baphomet', spawns: [{ map: 'prt_maze03', delay: 120, variance: 10 }] },
                    1873: { name: 'Beelzebub', spawns: [{ map: 'abbey03', delay: 720, variance: 10 }] },
                    1272: { name: 'Dark Lord', spawns: [
                        { map: 'gl_chyard', delay: 60, variance: 10 },
                        { map: 'gld_dun04', delay: 480, variance: 10 }
                    ]},
                    1719: { name: 'Detardeurus', spawns: [{ map: 'abyss_03', delay: 180, variance: 10 }] },
                    1046: { name: 'Doppelganger', spawns: [
                        { map: 'gef_dun02', delay: 120, variance: 10 },
                        { map: 'gld_dun02', delay: 480, variance: 10 }
                    ]},
                    1389: { name: 'Dracula', spawns: [{ map: 'gef_dun01', delay: 60, variance: 10 }] },
                    1112: { name: 'Drake', spawns: [{ map: 'treasure02', x: 101, y: 151, delay: 120, variance: 10 }] },
                    1115: { name: 'Eddga', spawns: [
                        { map: 'gld_dun01', delay: 480, variance: 10 },
                        { map: 'pay_fild11', delay: 120, variance: 10 }
                    ]},
                    1658: { name: 'Egnigem Cenia', spawns: [{ map: 'lhz_dun02', delay: 120, variance: 10 }] },
                    1418: { name: 'Evil Snake Lord', spawns: [{ map: 'gon_dun03', delay: 94, variance: 10 }] },
                    1871: { name: 'Fallen Bishop Hibram', spawns: [{ map: 'abbey02', x: 236, y: 78, delay: 120, variance: 10 }] },
                    1252: { name: 'Garm', spawns: [{ map: 'xmas_fild01', delay: 120, variance: 10 }] },
                    1768: { name: 'Gloom Under Night', spawns: [{ map: 'ra_san05', delay: 300, variance: 10 }] },
                    1086: { name: 'Golden Thief Bug', spawns: [{ map: 'prt_sewb4', delay: 60, variance: 10 }] },
                    1885: { name: 'Gopinich', spawns: [{ map: 'mosk_dun03', x: 207, y: 221, delay: 120, variance: 10 }] },
                    1832: { name: 'Ifrit', spawns: [{ map: 'thor_v03', delay: 660, variance: 10 }] },
                    1734: { name: 'Kiel D-01', spawns: [{ map: 'kh_dun02', delay: 120, variance: 20 }] },
                    1688: { name: 'Lady Tanee', spawns: [{ map: 'ayo_dun02', x: 150, y: 90, delay: 420, variance: 10 }] },
                    1373: { name: 'Lord of Death', spawns: [{ map: 'niflheim', delay: 133, variance: 0 }] },
                    1147: { name: 'Maya', spawns: [
                        { map: 'anthell02', delay: 120, variance: 10 },
                        { map: 'gld_dun03', delay: 480, variance: 10 }
                    ]},
                    1059: { name: 'Mistress', spawns: [{ map: 'mjolnir_04', delay: 120, variance: 10 }] },
                    1150: { name: 'Moonlight Flower', spawns: [{ map: 'pay_dun04', x: 120, y: 115, delay: 60, variance: 10 }] },
                    1087: { name: 'Orc Hero', spawns: [
                        { map: 'gef_fild02', delay: 1440, variance: 10 },
                        { map: 'gef_fild14', delay: 60, variance: 10 }
                    ]},
                    1190: { name: 'Orc Lord', spawns: [{ map: 'gef_fild10', delay: 120, variance: 10 }] },
                    1038: { name: 'Osiris', spawns: [{ map: 'moc_pryd04', delay: 60, variance: 10 }] },
                    1157: { name: 'Pharaoh', spawns: [{ map: 'in_sphinx5', delay: 60, variance: 10 }] },
                    1159: { name: 'Phreeoni', spawns: [{ map: 'moc_fild17', delay: 120, variance: 10 }] },
                    1623: { name: 'RSX-0806', spawns: [{ map: 'ein_dun02', delay: 125, variance: 10 }] },
                    1492: { name: 'Samurai Specter', spawns: [{ map: 'ama_dun03', delay: 91, variance: 10 }] },
                    1251: { name: 'Stormy Knight', spawns: [{ map: 'xmas_dun02', delay: 60, variance: 10 }] },
                    1583: { name: 'Tao Gunka', spawns: [{ map: 'beach_dun', delay: 300, variance: 10 }] },
                    1312: { name: 'Turtle General', spawns: [{ map: 'tur_dun04', x: 99, y: 93, delay: 60, variance: 10 }] },
                    1751: { name: 'Valkyrie Randgris', spawns: [{ map: 'odin_tem03', delay: 480, variance: 10 }] },
                    1685: { name: 'Vesper', spawns: [{ map: 'jupe_core', delay: 120, variance: 10 }] },
                    1630: { name: 'White Lady', spawns: [{ map: 'lou_dun03', delay: 117, variance: 10 }] },
                    1917: { name: 'Wounded Satan Morroc', spawns: [{ map: 'moc_fild22', delay: 720, variance: 60 }] },
                    2202: { name: 'Kraken', spawns: [{ map: 'iz_dun05', delay: 135, variance: 15 }] }
                    ,
                    // Special: Bio Lab 3 MVPs (multiple possible bosses, random spawn)
                    'bio_lab_3': {
                        name: 'Bio Lab 3 MVP',
                        possible_mvps: [
                            'Assassin Cross Eremes',
                            'High Priest Margaretha',
                            'High Wizard Kathryne',
                            'Lord Knight Seyren',
                            'Sniper Cecil',
                            'Whitesmith Howard'
                        ],
                        mvp_ids: {
                            'Assassin Cross Eremes': 1647,
                            'High Priest Margaretha': 1649,
                            'High Wizard Kathryne': 1651,
                            'Lord Knight Seyren': 1646,
                            'Sniper Cecil': 1650,
                            'Whitesmith Howard': 1648
                        },
                        coordinates: [
                            [139,158],
                            [139,117],
                            [114,138],
                            [163,138],
                            [138,138],
                            [138,138]
                        ],
                        delay: 100,
                        variance: 30,
                        map: 'lhz_dun03'
                    }
                },
                // Active MVP timers (managed list) and full list built from `mvpDatabase`
                activeMvps: [],
                allMvps: [],
                // Search / sort UI for All MVPs
                mvpSearch: '',
                mvpSortBy: 'name',
                mvpSortDir: 'asc',
                spawnSelection: { open: false, mvpId: null, mvpName: '', choices: [], markAsDead: false },
                // UI helpers
                toasts: [],
                confirmDialog: { open: false, title: '', message: '', onConfirm: null },
                events: [
                    { 
                        id: 1, 
                        title: 'War of Emperium', 
                        description: 'Weekly castle siege. All hands on deck! We are defending Valkyrie 1.', 
                        month: 'NOV', 
                        day: '23', 
                        time: '20:00 GMT',
                        roles: [
                            { name: 'Tanks', needed: 5, filled: 5 },
                            { name: 'DPS', needed: 15, filled: 12 },
                            { name: 'Support', needed: 8, filled: 4 }
                        ]
                    },
                    { 
                        id: 2, 
                        title: 'Endless Tower Run', 
                        description: 'Climbing to floor 100. Priority on geared DPS.', 
                        month: 'NOV', 
                        day: '25', 
                        time: '18:00 GMT',
                         roles: [
                            { name: 'Tanks', needed: 2, filled: 1 },
                            { name: 'DPS', needed: 6, filled: 6 },
                            { name: 'Support', needed: 3, filled: 2 }
                        ]
                    }
                ],
                polls: [
                    {
                        id: 1,
                        question: 'Next Guild Dungeon Target?',
                        votes: 42,
                        options: [
                            { id: 'a', label: 'Payon', percent: 60 },
                            { id: 'b', label: 'Geffen', percent: 25 },
                            { id: 'c', label: 'Prontera', percent: 15 }
                        ]
                    },
                    {
                        id: 2,
                        question: 'Loot Distribution Method',
                        votes: 38,
                        options: [
                            { id: 'a', label: 'DKP System', percent: 45 },
                            { id: 'b', label: 'Roll Dice', percent: 55 }
                        ]
                    }
                ],
                getMvpRespawnInfo(mvpId) {
                    // First try database lookup
                    const mvpData = this.mvpDatabase[mvpId];
                    if (mvpData && mvpData.spawns && mvpData.spawns.length > 0) {
                        const spawn = mvpData.spawns[0];
                        const minDelay = spawn.delay;
                        const maxDelay = (spawn.delay || 0) + (spawn.variance || 0);
                        return `${minDelay}-${maxDelay} min`;
                    }
                    // Fallback: check built allMvps (covers composite entries like bio_lab_3)
                    const built = (this.allMvps || []).find(x => Number(x.id) === Number(mvpId));
                    if (built && built.spawns && built.spawns.length > 0) {
                        const spawn = built.spawns[0];
                        const minDelay = spawn.delay || 0;
                        const maxDelay = (spawn.delay || 0) + (spawn.variance || 0);
                        if (minDelay > 0) return `${minDelay}-${maxDelay} min`;
                    }
                    return 'Unknown';
                },
                // Build `allMvps` from `mvpDatabase` including special multi-mvp entries (bio_lab_3)
                buildAllMvps() {
                    const list = [];
                    Object.keys(this.mvpDatabase).forEach(key => {
                        const entry = this.mvpDatabase[key];
                        // Special composite entry (like bio_lab_3)
                        if (entry && entry.mvp_ids) {
                            // Attach full coordinates list so each possible boss can show
                            // the set of possible spawn cells (they spawn randomly among them)
                            const coords = entry.coordinates || [];
                            entry.possible_mvps.forEach((name, idx) => {
                                const id = entry.mvp_ids[name];
                                const spawn = {
                                    map: entry.map,
                                    // individual x/y not deterministic; provide coordsList instead
                                    coordsList: coords.map(c => ({ x: c[0], y: c[1] })),
                                    delay: entry.delay,
                                    variance: entry.variance
                                };
                                list.push({ id: id, name: name, spawns: [spawn], _composite: 'bio_lab_3' });
                            });
                        } else if (!isNaN(Number(key))) {
                            // Regular numeric keyed MVPs
                            const id = Number(key);
                            list.push({ id: id, name: entry.name, spawns: entry.spawns.map(s => Object.assign({}, s)) });
                        }
                    });
                    // Sort by name for easier browsing
                    list.sort((a, b) => a.name.localeCompare(b.name));
                    this.allMvps = list;
                },

                // Helper: return true if id belongs to the bio_lab_3 composite
                isBioLab3Id(id) {
                    try {
                        const entry = this.mvpDatabase['bio_lab_3'];
                        if (!entry || !entry.mvp_ids) return false;
                        return Object.values(entry.mvp_ids).some(v => Number(v) === Number(id));
                    } catch (e) { return false; }
                },

                // Helper: return true if any bio_lab_3 id is currently tracked
                isAnyBioLab3Tracked() {
                    try {
                        const entry = this.mvpDatabase['bio_lab_3'];
                        if (!entry || !entry.mvp_ids) return false;
                        const ids = new Set(Object.values(entry.mvp_ids).map(v => Number(v)));
                        return this.activeMvps.some(a => ids.has(Number(a.id)));
                    } catch (e) { return false; }
                },

                // Return filtered and sorted All MVPs based on search and sort controls
                filteredAll() {
                    const q = (this.mvpSearch || '').trim().toLowerCase();
                    let list = Array.isArray(this.allMvps) ? this.allMvps.slice() : [];
                    if (q) {
                        list = list.filter(m => {
                            const name = (m.name || '').toLowerCase();
                            const idStr = String(m.id || '');
                            return name.includes(q) || idStr.includes(q);
                        });
                    }
                    // Exclude entries that are already tracked.
                    list = list.filter(m => {
                        // If Bio Lab 3 and any bio lab tracked -> hide all bio lab entries
                        if (this.isBioLab3Id(m.id) && this.isAnyBioLab3Tracked()) return false;
                        // If single-spawn and that exact id+map is tracked, hide
                        if (m.spawns && m.spawns.length === 1) {
                            const map = m.spawns[0].map;
                            if (this.isTrackedOnMap(m.id, map)) return false;
                        }
                        // If multi-spawn, hide only when all spawn maps are already tracked
                        if (m.spawns && m.spawns.length > 1) {
                            const allTracked = m.spawns.every(s => this.isTrackedOnMap(m.id, s.map));
                            if (allTracked) return false;
                        }
                        return true;
                    });
                    const sortBy = this.mvpSortBy || 'name';
                    const dir = this.mvpSortDir === 'desc' ? -1 : 1;
                    list.sort((a, b) => {
                        if (sortBy === 'id') {
                            return dir * ((a.id || 0) - (b.id || 0));
                        }
                        // default: name
                        const an = (a.name || '').localeCompare(b.name || '');
                        return dir * an;
                    });
                    return list;
                },

                // Persistence helpers
                saveActiveMvps() {
                    try {
                        localStorage.setItem('bigfish_active_mvps_v1', JSON.stringify(this.activeMvps));
                    } catch (e) {
                        console.warn('Failed saving activeMvps', e);
                    }
                },

                loadActiveMvps() {
                    try {
                        const raw = localStorage.getItem('bigfish_active_mvps_v1');
                        if (!raw) return;
                        const parsed = JSON.parse(raw);
                        if (Array.isArray(parsed)) {
                            // Coerce timestamp fields to numbers and restore phases
                            this.activeMvps = parsed.map(a => {
                                if (a.killedAt) a.killedAt = Number(a.killedAt);
                                if (a.minTarget) a.minTarget = Number(a.minTarget);
                                if (a.maxTarget) a.maxTarget = Number(a.maxTarget);
                                // derive phase
                                if (a.status === 'dead') {
                                    a._respawnPhase = (a.minTarget && Date.now() >= a.minTarget) ? (a.maxTarget && Date.now() < a.maxTarget ? 'window' : 'alive') : 'countdown';
                                } else {
                                    a._respawnPhase = 'alive';
                                }
                                return a;
                            });
                            // Immediately update displays once loaded
                            this.updateAllRespawnDisplays();
                        }
                    } catch (e) {
                        console.warn('Failed loading activeMvps', e);
                    }
                },

                // Add an MVP to active tracker. If multiple spawns exist, open selection modal.
                addMvpToTracker(mvpId, markAsDead = false) {
                    const entry = this.allMvps.find(m => m.id === mvpId);
                    if (!entry) return;
                    if (!entry.spawns || entry.spawns.length === 0) return;
                    // Enforce Bio Lab 3 rule: only one of the composite MVPs may be tracked at a time
                    if (this.isBioLab3Id(entry.id) && this.isAnyBioLab3Tracked()) {
                        // Bio Lab 3 rule: UI hides other biolab entries, so silently refuse here
                        return;
                    }
                    if (entry.spawns.length === 1) {
                        const spawn = entry.spawns[0];
                        // Prevent duplicate id+map entries
                        if (this.isTrackedOnMap(entry.id, spawn.map)) {
                            this.showToast('Already tracking this MVP on that map', 'warning');
                            return;
                        }
                        const item = { id: entry.id, name: entry.name, map: spawn.map, status: markAsDead ? 'dead' : 'alive', respawnTime: markAsDead ? 'Calculating...' : 'Now', coords: this.getCoordsText(spawn), spawn: spawn };
                        this.activeMvps.push(item);
                        this.saveActiveMvps();
                        if (markAsDead) this.reportKill(item);
                    } else {
                        // open selection modal with choices but filter out maps already tracked
                            const rawChoices = entry.spawns.map((s, i) => ({ index: i, map: s.map, coords: this.getCoordsText(s), spawn: s }));
                            const choices = rawChoices.filter(c => !this.isTrackedOnMap(entry.id, c.map));
                            if (!choices || choices.length === 0) {
                                // nothing available to track for this MVP (all maps tracked)
                                return;
                            }
                            this.spawnSelection.open = true;
                            this.spawnSelection.mvpId = entry.id;
                            this.spawnSelection.mvpName = entry.name;
                            this.spawnSelection.choices = choices;
                            this.spawnSelection.markAsDead = markAsDead;
                    }
                },

                // Confirm choice from the spawn selection modal
                confirmSpawnSelection(choice) {
                        const entry = this.allMvps.find(m => m.id === this.spawnSelection.mvpId);
                        if (!entry) return;
                        const spawn = choice.spawn;
                        // Enforce Bio Lab 3 rule here as well
                        if (this.isBioLab3Id(entry.id) && this.isAnyBioLab3Tracked()) {
                            // Bio Lab 3 rule: modal shouldn't open for other biolab entries; close quietly
                            this.spawnSelection.open = false;
                            this.spawnSelection.choices = [];
                            this.spawnSelection.mvpId = null;
                            this.spawnSelection.markAsDead = false;
                            return;
                        }
                        // prevent duplicate id+map
                        if (this.isTrackedOnMap(entry.id, spawn.map)) {
                            // close modal and notify
                            this.spawnSelection.open = false;
                            this.spawnSelection.choices = [];
                            this.spawnSelection.mvpId = null;
                            this.spawnSelection.markAsDead = false;
                            this.showToast('Already tracking this MVP on that map', 'warning');
                            return;
                        }
                        const item = { id: entry.id, name: entry.name, map: spawn.map, status: this.spawnSelection.markAsDead ? 'dead' : 'alive', respawnTime: this.spawnSelection.markAsDead ? 'Calculating...' : 'Now', coords: this.getCoordsText(spawn), spawn: spawn };
                        this.activeMvps.push(item);
                        this.spawnSelection.open = false;
                        this.spawnSelection.choices = [];
                        this.spawnSelection.mvpId = null;
                        // persist
                        this.saveActiveMvps();
                        if (this.spawnSelection.markAsDead) {
                            // calculate respawn
                            this.reportKill(item);
                            this.spawnSelection.markAsDead = false;
                        }
                },

                removeActiveMvp(index) {
                    this.activeMvps.splice(index, 1);
                    this.saveActiveMvps();
                },

                getCoordsText(spawn) {
                    // If spawn contains a coordsList (composite entries), join them
                    if (spawn && spawn.coordsList && Array.isArray(spawn.coordsList) && spawn.coordsList.length > 0) {
                        return spawn.coordsList.map(c => `(${c.x}, ${c.y})`).join(' ');
                    }
                    if (spawn.x !== undefined && spawn.y !== undefined) return `(${spawn.x}, ${spawn.y})`;
                    return spawn.coords || 'Random';
                },
                // Return true if MVP (any spawn) is already tracked (by id)
                isTracked(m) {
                    return this.activeMvps.some(a => a.id === m.id);
                },
                // Return true if MVP id is tracked on a specific map
                isTrackedOnMap(id, map) {
                    return this.activeMvps.some(a => a.id === id && a.map === map);
                },
                // Count how many tracked entries exist for this MVP id
                getTrackedCount(m) {
                    return this.activeMvps.filter(a => a.id === m.id).length;
                },
                getTrackedStatusText(m) {
                    const c = this.getTrackedCount(m);
                    if (c === 0) return 'UNTRACKED';
                    return c === 1 ? 'TRACKED' : `TRACKED (${c})`;
                },
                getTrackedStatusClass(m) {
                    if (this.getTrackedCount(m) > 0) {
                        if (this.currentTheme === 'dark') return 'bg-green-900 text-green-300 border border-green-700';
                        if (this.currentTheme === 'light') return 'bg-green-100 text-green-800 border border-slate-200';
                        return 'text-[green] font-bold';
                    } else {
                        if (this.currentTheme === 'dark') return 'bg-guild-900 text-slate-300 border border-guild-600 opacity-80';
                        if (this.currentTheme === 'light') return 'bg-slate-100 text-slate-700 border border-slate-200 opacity-80';
                        return 'text-[#000000]';
                    }
                },
                reportKill(mvp) {
                    // Mark dead and compute absolute respawn window timestamps
                    mvp.status = 'dead';
                    mvp.respawnTime = 'Calculating...';
                    const now = Date.now();
                    // Try to use the spawn data attached to the tracked item first
                    let spawn = mvp.spawn;
                    if (!spawn) {
                        const mvpData = this.mvpDatabase[mvp.id];
                        spawn = (mvpData && mvpData.spawns && mvpData.spawns.length > 0) ? (mvpData.spawns.find(s => s.map === mvp.map) || mvpData.spawns[0]) : null;
                    }
                    if (spawn) {
                        const minDelay = (spawn.delay || 0) * 60 * 1000; // minutes -> ms
                        const maxDelay = ((spawn.delay || 0) + (spawn.variance || 0)) * 60 * 1000;
                        mvp.killedAt = now;
                        mvp.minTarget = now + minDelay;
                        mvp.maxTarget = now + maxDelay;
                        mvp._respawnPhase = 'countdown';
                    } else {
                        // Fallback: estimate 2 hours
                        mvp.killedAt = now;
                        mvp.minTarget = now + (120 * 60 * 1000);
                        mvp.maxTarget = now + (120 * 60 * 1000) + (10 * 60 * 1000);
                        mvp._respawnPhase = 'countdown';
                    }
                    // Persist initial values; ticker will update display
                    this.saveActiveMvps();
                },

                // Start the global respawn ticker to update countdowns every second
                startRespawnTicker() {
                    if (this._respawnInterval) clearInterval(this._respawnInterval);
                    this._respawnInterval = setInterval(() => this.updateAllRespawnDisplays(), 1000);
                },

                updateAllRespawnDisplays() {
                    const now = Date.now();
                    let changed = false;
                    this.activeMvps.forEach(m => {
                        const prevPhase = m._respawnPhase || (m.status === 'dead' ? 'countdown' : 'alive');
                        this.updateRespawnDisplay(m, now);
                        const newPhase = m._respawnPhase || (m.status === 'dead' ? 'countdown' : 'alive');
                        // trigger alert when entering the spawn window (countdown -> window)
                        if (prevPhase !== newPhase && newPhase === 'window') {
                            this.showSpawnAlert(m);
                        }
                        if (newPhase !== prevPhase) changed = true;
                    });
                    if (changed) this.saveActiveMvps();
                },

                // Show toast, browser notification, and play a short sound when spawn window opens
                showSpawnAlert(mvp) {
                    try {
                        const title = `${mvp.name} spawn window open`;
                        const message = `Spawn window open on ${mvp.map}`;
                        this.showToast(message, 'warning', title);
                        // Browser Notification
                        if ("Notification" in window) {
                            if (Notification.permission === 'granted') {
                                const n = new Notification(title, { body: message });
                                n.onclick = () => { window.focus(); };
                            } else if (Notification.permission !== 'denied') {
                                Notification.requestPermission().then(p => {
                                    if (p === 'granted') {
                                        const n = new Notification(title, { body: message });
                                        n.onclick = () => { window.focus(); };
                                    }
                                });
                            }
                        }
                        // Play beep via WebAudio
                        this.playAlertSound();
                    } catch (e) {
                        console.warn('Failed to show spawn alert', e);
                    }
                },

                // Simple beep using WebAudio API
                playAlertSound() {
                    try {
                        const AudioCtx = window.AudioContext || window.webkitAudioContext;
                        if (!AudioCtx) return;
                        const ctx = new AudioCtx();
                        const o = ctx.createOscillator();
                        const g = ctx.createGain();
                        o.type = 'sine';
                        o.frequency.setValueAtTime(880, ctx.currentTime);
                        g.gain.setValueAtTime(0.0001, ctx.currentTime);
                        g.gain.exponentialRampToValueAtTime(0.2, ctx.currentTime + 0.01);
                        o.connect(g); g.connect(ctx.destination);
                        o.start();
                        setTimeout(() => {
                            g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.05);
                            setTimeout(() => { try { o.stop(); ctx.close(); } catch (e) {} }, 70);
                        }, 250);
                    } catch (e) { console.warn('playAlertSound failed', e); }
                },

                updateRespawnDisplay(mvp, now = Date.now()) {
                    if (!mvp || mvp.status !== 'dead') return;
                    if (!mvp.minTarget || !mvp.maxTarget) return;
                    const minT = Number(mvp.minTarget);
                    const maxT = Number(mvp.maxTarget);
                    if (now < minT) {
                        // Still waiting for min spawn
                        const remain = minT - now;
                        mvp.respawnTime = 'Respawning in ' + this.formatDuration(remain);
                        mvp._respawnPhase = 'countdown';
                    } else if (now >= minT && now < maxT) {
                        // Within spawn window
                        const windowTotal = maxT - minT;
                        const remain = maxT - now;
                        const minutesWindow = Math.ceil(windowTotal / 60000);
                        mvp.respawnTime = `Respawning now for ${minutesWindow} min — ${this.formatDuration(remain)}`;
                        mvp._respawnPhase = 'window';
                    } else {
                        // Past max, assume respawned
                        mvp.status = 'alive';
                        mvp.respawnTime = 'Now';
                        delete mvp.killedAt;
                        delete mvp.minTarget;
                        delete mvp.maxTarget;
                        mvp._respawnPhase = 'alive';
                    }
                },

                formatDuration(ms) {
                    if (ms <= 0) return '0s';
                    const totalSeconds = Math.floor(ms / 1000);
                    const hours = Math.floor(totalSeconds / 3600);
                    const minutes = Math.floor((totalSeconds % 3600) / 60);
                    const seconds = totalSeconds % 60;
                    if (hours > 0) return `${hours}h ${minutes}m ${seconds}s`;
                    if (minutes > 0) return `${minutes}m ${seconds}s`;
                    return `${seconds}s`;
                },
                untrackAll() {
                    if (!this.activeMvps || this.activeMvps.length === 0) {
                        this.showToast('No active MVPs to untrack', 'info');
                        return;
                    }
                    this.openConfirm('Untrack All', 'Untrack ALL active MVPs? This cannot be undone.', () => {
                        this.activeMvps = [];
                        this.saveActiveMvps();
                        this.showToast('All MVPs untracked', 'success');
                    });
                },

                // Toast helpers
                showToast(message, type = 'info', title = '') {
                    const id = Date.now().toString(36) + Math.random().toString(36).slice(2, 7);
                    const t = { id, message, type, title, visible: true };
                    this.toasts.push(t);
                    // Auto-remove after 4s
                    setTimeout(() => this.removeToast(id), 4000);
                },
                removeToast(id) {
                    const idx = this.toasts.findIndex(x => x.id === id);
                    if (idx === -1) return;
                    // fade out
                    this.toasts[idx].visible = false;
                    setTimeout(() => { this.toasts = this.toasts.filter(x => x.id !== id); }, 300);
                },

                // Confirm dialog helper
                openConfirm(title, message, onConfirm) {
                    this.confirmDialog.title = title || 'Confirm';
                    this.confirmDialog.message = message || '';
                    this.confirmDialog.onConfirm = onConfirm || null;
                    this.confirmDialog.open = true;
                },
                vote(pollId, optionId) {
                    alert('Vote cast! (This is a frontend demo)');
                }
            }
        }
    </script>
</body>
</html>